<div class="container">
  <h1>Sprints</h1>

  <div class= "small-cards-container">
    <%# 1st small-card %>
    <%= link_to new_ticket_path do %>
      <div class= "small-card">
        <p><i class="fa-regular fa-comments"></i> Tire dúvidas</p>
        <h4 style="color:#008100;"> Abrir um Ticket</h4>
        <%# <p id="small-subtitle">com um Professor ou TA</p> %>
      </div>
    <% end %>

    <%# 2nd small-card %>
    <%= link_to project_path(@project) do %>
      <div class= "small-card">
        <p><i class="fa-solid fa-mug-saucer"></i>  Projeto Atual</p>
        <h4><%= @project.name %></h4>
        <footer>detalhes</footer>
      </div>
    <% end %>

    <%# 3rd small-card %>
    <%= link_to new_project_sprint_path(@project) do %>
      <div class= "small-card">
        <p><i class="fa-regular fa-square-plus"></i> Criar uma</p>
        <h4 style="color:#008100;">Nova Sprint</h4>
      </div>
    <% end %>
  </div>

  <%= render partial: 'progress_bars/sprint_progress_steps', locals: {active_sprint: @project.active_sprint} %>
  <%  @project.sprints.each.with_index(1) do |sprint, sprint_number| %>
    <div class = 'card_main'>
      <!--Div main card header-->
      <div class="main-card-header">
        <h2 class="px-5 mt-3"><i class="fa-regular fa-lightbulb"></i> Sprint #<%= sprint_number %></h2>
        
      </div>

      <!--Div Objetivos da Sprint-->
      <div class="objective-card">
        <h5>Objetivo:</h5>
        <p><%= sprint.objective %></p>
      </div>

      <!--Div Table da Sprint-->
      <div class="table-responsive col-12 p-5">
        <table class="table">
          <thead>
            <tr class="b_g_white">
              <th class='px-3'>
              Tarefas
              <%= link_to new_project_sprint_task_path(@project, sprint) do %>
              <i class="fa-solid fa-circle-plus"></i>
              <% end %>
              </th>
              <th class= 'text-right'>Responsável</th>
              <th class= 'text-center'>Status</th>
              <th class= 'text-center'>Pontuação</th>
              <th class= 'text-right'></th>
            </tr>
          </thead>
          <tbody>
          <% sprint.tasks.each do |task| %>
            <tr>
            <!--Nome Tarefa-->
              <td class ="py-4 px-3" ><%= task.name %></td>
            <!--Criador/Responsável pela tarefa-->
              <td class ="p-3 text-right">
                <% if task.user.photo.present?  %>
                    <%= cl_image_tag task.user.photo.key, class: "avatar-large mx-5" %>
                  <% else %>
                    <%= image_tag "not_found.jpg", class: "avatar-large mx-5" %>
                  <% end %>
                <%= task.user.name %>
              </td>

              <!--Status-->
              <td class ="py-4 px-3 text-center">
                <% if task.status == "Finalizada" %>
                  <p class="green-tag"> Finalizada </p>
                <% elsif task.status == "Em Andamento"%>
                  <p class="light-green-tag"> Em Andamento </p>
                <% elsif task.status == "Não Iniciada"%>
                  <p class="gray-tag"> Não Iniciada </p>
                <% end %>
              </td>

              <!--Pontuação-->
              <td class ="py-4 px-3 text-center" ><%= task.points %></td>

              <!--Edição e Deletar-->
              <td>
                <%= link_to edit_task_path(task) do %>
                <i class="fa-solid fa-pen-to-square"></i>
                <% end %>

                <%= link_to task_path(task), data: {turbo_method: :delete, turbo_confirm: "Tem certeza que quer deletar esta Tarefa?"}  do %>
                <i class="fa-solid fa-trash"></i>
                <% end %>

              </td>

            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div>
